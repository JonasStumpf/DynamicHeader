/*!
* DynamicHeader.js
* Version: 1.1.0
* License: MIT
* Copyright: 2024 Jonas Stumpf
*/
var DH=(()=>{var l=Object.defineProperty;var C=Object.getOwnPropertyDescriptor;var y=Object.getOwnPropertyNames;var O=Object.prototype.hasOwnProperty;var r=(i,t)=>l(i,"name",{value:t,configurable:!0});var P=(i,t)=>{for(var e in t)l(i,e,{get:t[e],enumerable:!0})},k=(i,t,e,s)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of y(t))!O.call(i,o)&&o!==e&&l(i,o,{get:()=>t[o],enumerable:!(s=C(t,o))||s.enumerable});return i};var E=i=>k(l({},"__esModule",{value:!0}),i);var w={};P(w,{Checkpoint:()=>p,Component:()=>n,DynamicHeader:()=>d,Scroll:()=>f,Sections:()=>u});var h=class{static{r(this,"EventManager")}#t={};on(t,e){this.#t[t]||(this.#t[t]=[]),this.remove(t,e),this.#t[t].push(e)}remove(t,e){if(!this.#t[t])return!1;let s=this.#t[t].indexOf(e);return s>-1&&this.#t[t].splice(s,1),!0}dispatch(t,e={},s=[],o={}){this.#e(t,e,s,o),this.#s(t,e)}#e(t,e,s,o){if(!s)return;let m=new CustomEvent(t,{cancelable:!0,...o,detail:e});for(let b of s)b.dispatchEvent(m)}#s(t,e){if(this.#t[t])for(let s of this.#t[t])s.apply(this,[e])}};function g(i,t){let e=!1;return()=>{e||(e=!0,i.apply(this,arguments),setTimeout(()=>{e=!1},t))}}r(g,"throttle");function v(i,t){let e,s=!1,o={start:i.start||i,mid:i.mid||i,end:i.end||i};return()=>{s||(e?o.mid.apply(this,arguments):o.start.apply(this,arguments),s=!0,setTimeout(()=>{s=!1},t)),clearTimeout(e),e=setTimeout(()=>{e=null,o.end.apply(this,arguments)},t)}}r(v,"flatten");function a(i){if(i instanceof Element)return i;try{let t=document.querySelector(i);return t instanceof Element?t:!1}catch{return!1}}r(a,"getDOMElement");function x(i,t=!0){if(!i.forEach)return i instanceof Element?[domEl]:document.querySelectorAll(i);let e=[];for(let s of i)s instanceof Element?t&&e.indexOf(s)===-1&&e.push(s):e=t?e.concat([...document.querySelectorAll(s)].filter(o=>e.indexOf(o)===-1)):e.concat([...document.querySelectorAll(s)]);return e}r(x,"getDOMElements");var d=class{static{r(this,"DynamicHeader")}#t;#e=[];#s=new h;#i={header:"header",prefix:"dh",resizeDelay:500,targetEvents:!1};Components={};constructor(t,e=[]){this.#i={...this.#i,...t},this.#t=a(this.#i.header),this.dispatch=this.#i.targetEvents?this.#n:this.#r,this.mount(e)}mount(t){for(let e of t){let s=new e;this.Components[s.getName()]||(this.Components[s.getName()]=s,s.mount(this,this.#i[s.getName()]),s.init())}}detectResize(){this.resizeObs||(this.sectionResizeObs=new ResizeObserver(g(()=>this.dispatch("resize",this.#t,[this.#t]),this.#i.resizeDelay,this.#i.resizeDelay)),this.sectionResizeObs.observe(this.#t))}destroy(){this.addClass=()=>{};for(let t of this.#e)this.#t.classList.remove(t);this.#e=[];for(let t of Object.values(this.Components))t.destroy();this.#s=null,this.dispatch=()=>{}}addClass(t){this.#t.classList.add(t),this.#e.push(t)}removeClass(t){this.#t.classList.remove(t);let e=this.#e.indexOf(t);e>-1&&this.#e.splice(e,1)}getComponent(t){return this.Components[t]}getHeader(){return this.#t}getPrefix(){return this.#i.prefix+"-"}getPrefixed(t){return this.getPrefix()+t}on(t,e){this.#s.on(this.getPrefixed(t),e)}remove(t,e){this.#s.remove(this.getPrefixed(t),e)}#o(t,e={},s=[],o={}){this.#s.dispatch(this.getPrefixed(t),e,s,o)}#r(t,e={}){this.#o(t,e)}#n(t,e={},s=[],o={}){this.#o(t,e,[this.#t,...s],o)}};var n=class i{static{r(this,"Component")}#t;constructor(){if(new.target===i)throw new TypeError("Cannot construct Component instances directly.");this.#t=new.target.name}mount(t,e){this.dh=t,this.options={...this.options,...e}}init(){}destroy(){}getName(){return this.#t}};var p=class extends n{static{r(this,"Checkpoint")}options={obsRoot:null,obsMargin:"0px",obsThreshold:0,checkpoints:[],cpClass:"checkpoint",dataName:"checkpoint"};#t={top:{pos:"top:20px",class:"dh-top",id:"dh-checkpoint-top"},bot:{pos:"bottom:20px",class:"dh-bot",id:"dh-checkpoint-bot"},mid:{pos:"top:50%",class:"dh-mid",id:"dh-checkpoint-mid"}};#e=[];#s;init(){this.#o(),this.#i()}#i(){for(let t of this.options.checkpoints)this.addCheckPoint(t)}#o(){this.#s?.disconnect(),this.#s=new IntersectionObserver(t=>this.#r(t),{root:this.options.obsRoot,rootMargin:this.options.obsMargin,threshold:this.options.obsThreshold})}#r(t){for(let e of t){let s=e.target.getAttribute(this.dh.getPrefixed(this.options.dataName)),o={checkpoint:e.target,intersecting:e.isIntersecting,class:s};this.dh.dispatch("checkpoint",o,[e.target]),s&&(e.isIntersecting?this.dh.addClass(s):this.dh.removeClass(s))}}createCheckPoint(t){let e=document.createElement("div");return e.style.cssText=`position:absolute;visibility:hidden;${t.pos}`,e.setAttribute(this.dh.getPrefixed(this.options.dataName),t.class||""),t.id&&(e.id=t.id),document.querySelector("body").append(e),e}addCheckPoint(t){return t=(this.#t[t]?this.createCheckPoint(this.#t[t]):!1)||a(t)||this.createCheckPoint(t),t.classList.add(this.dh.getPrefixed(this.options.cpClass)),this.#e.push(t),this.#s?.observe(t),t}removeCheckpoint(t){this.#s?.unobserve(t);let e=this.#e.indexOf(t);return e<=-1?!1:(this.#e.splice(e,1),!0)}deleteCheckpoint(t){return this.removeCheckpoint(t)?(t.remove(),!0):!1}getCheckpoints(){return this.#e}destroy(){for(let t=this.#e.length-1;t>=0;t--)this.deleteCheckpoint(this.#e[t]);this.#s?.disconnect()}};var c=class{static{r(this,"ScrollObserver")}defaultOptions={root:window,delay:250};#t={start:()=>this.scrollHandler("start"),mid:()=>this.scrollHandler("mid"),end:()=>this.scrollHandler("end")};events={start:[],mid:[],end:[],scroll:[]};constructor(t){this.options={...this.defaultOptions,...t},this.eventHandler=v(this.#t,this.options.delay),this.setScrollPos(),this.options.root.addEventListener("scroll",this.eventHandler),this.scrolling=!1}destroy(){this.options.root.removeEventListener("scroll",this.eventHandler);for(let t of Object.keys(this.events))this.events[t]=[]}scrollHandler(t){let e=this.getScrollPos(),s={position:e,direction:e<=this.scrollPos?-1:1,state:t};for(let o of[...this.events[t],...this.events.scroll])o(s);this.setScrollPos()}setScrollPos(){this.scrollPos=this.getScrollPos()}getScrollPos(){return this.options.root.scrollY}on(t,e){this.events[t].push(e)}remove(t,e){let s=this.events[t].indexOf(e);s>-1&&this.events[t].splice(s,1)}};var f=class extends n{static{r(this,"Scroll")}options={root:window,delay:250,classUp:"scroll-up",classDown:"scroll-down",modes:["scroll"]};#t;init(){this.options.classes={1:this.options.classDown,"-1":this.options.classUp},this.#t=new c({root:this.options.root,delay:this.options.delay});for(let t of this.options.modes)this.#t.on(t,e=>this.#e(e))}#e(t){this.dh.dispatch("scroll",t),this.dh.removeClass(this.options.classes[t.direction*-1]),this.dh.addClass(this.options.classes[t.direction])}destroy(){this.#t.destroy()}getObserver(){return this.#t}};var u=class extends n{static{r(this,"Sections")}options={sections:"section",obsRoot:null,dataName:"section"};#t;init(){this.sections=[...x(this.options.sections)],this.#i(this.sections[0]),this.#e(),this.dh.detectResize(),this.dh.on("resize",()=>this.#r())}#e(){this.#n(),this.#t?.disconnect(),this.#t=new IntersectionObserver(t=>this.#s(t),{root:this.options.obsRoot,rootMargin:`${this.#h()/-2}px 0px 0px 0px`,threshold:0});for(let t of this.sections)this.#t.observe(t)}#s(t){let e;for(let s=0;s<t.length;s++){let o=t[s];if(this.#o(o.target))if(o.isIntersecting)e=o.target;else{let m=this.sections.indexOf(o.target);e=this.sections[++m]}}this.#i(e)}#i(t){if(!t)return;let e={section:t,removed:this.currClass};this.setClass(t.getAttribute(this.dh.getPrefixed(this.options.dataName))),e.added=this.currClass,this.dh.dispatch("section",e,[t])}setClass(t){this.dh.removeClass(this.currClass),this.dh.addClass(t),this.currClass=t}destroy(){this.#t?.disconnect()}getObserver(){return this.#t}#o(t){return t.getBoundingClientRect().top+this.#h()<0}#r(){return this.dh.getHeader().offsetHeight==this.#h()?!1:(this.#e(),!0)}#n(){this.headerHeight=this.dh.getHeader().offsetHeight}#h(){return this.headerHeight}};return E(w);})();
